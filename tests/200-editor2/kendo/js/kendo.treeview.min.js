/*
* Kendo UI Web v2012.2.710 (http://kendoui.com)
* Copyright 2012 Telerik AD. All rights reserved.
*
* Kendo UI Web commercial licenses may be obtained at http://kendoui.com/web-license
* If you do not own a commercial license, this file shall be governed by the
* GNU General Public License (GPL) version 3.
* For GPL requirements, please review: http://www.gnu.org/copyleft/gpl.html
*/
;(function(a,b){function K(a){var b=this;b.treeview=a,b._draggable=new d.Draggable(a.element,{filter:"div:not(.k-state-disabled) .k-in",hint:function(a){return z.dragClue({text:a.text()})},cursorOffset:{left:10,top:c.support.touch?-40/c.support.zoomLevel():10},dragstart:k(b.dragstart,b),dragcancel:k(b.dragcancel,b),drag:k(b.drag,b),dragend:k(b.dragend,b)})}function J(a,b,c){var d=a.children("div"),e=a.children("ul");a.hasClass("k-treeview")||(c=f({expanded:e.css("display")!="none",index:a.index(),enabled:!d.children(".k-in").hasClass("k-state-disabled")},c),b=f({firstLevel:a.parent().parent().hasClass(w),length:a.parent().children().length},b),a.removeClass("k-first k-last").addClass(A.wrapperCssClass(b,c)),d.removeClass("k-top k-mid k-bot").addClass(A.cssClass(b,c)),d.children(".k-in").removeClass("k-in k-state-default k-state-disabled").addClass(A.textClass(c)),e.length&&(d.children(".k-icon").removeClass("k-plus k-minus k-plus-disabled k-minus-disabled").addClass(A.toggleButtonClass(c)),e.addClass("k-group")))}function I(b){var c=b.children("div"),d=b.children("ul"),e=c.children(".k-icon"),f=c.children(".k-in"),g,h;if(!b.hasClass("k-treeview")){c.length||(c=a("<div />").prependTo(b));if(!e.length&&d.length)e=a("<span class='k-icon' />").prependTo(c);else if(!d.length||!d.children().length)e.remove(),d.remove();if(!f.length){f=a("<span class='k-in' />").appendTo(c)[0],g=c[0].nextSibling,f=c.find(".k-in")[0];while(g&&g.nodeName.toLowerCase()!="ul")h=g,g=g.nextSibling,h.nodeType==3&&(h.nodeValue=a.trim(h.nodeValue)),f.appendChild(h)}}}function H(b){return a(b).closest("[data-role=treeview]").data("kendoTreeView")}function G(a){return function(b){var c=b.children(".k-animation-container");c.length||(c=b);return c.children(a)}}var c=window.kendo,d=c.ui,e=c.data,f=a.extend,g=c.template,h=a.isArray,i=d.Widget,j=e.HierarchicalDataSource,k=a.proxy,l="select",m="expand",n="change",o="collapse",p="dragstart",q="drag",r="drop",s="dragend",t="click",u="visibility",v="k-state-hover",w="k-treeview",x=":visible",y=".k-item",z,A,B,C,D,E={text:"dataTextField",url:"dataUrlField",spriteCssClass:"dataSpriteCssClassField",imageUrl:"dataImageUrlField"},F=function(a){return typeof HTMLElement=="object"?a instanceof HTMLElement:a&&typeof a=="object"&&a.nodeType===1&&typeof a.nodeName=="string"};C=G(".k-group"),D=G(".k-group,.k-content"),z={dragClue:g("<div class='k-header k-drag-clue'><span class='k-icon k-drag-status'></span>#= text #</div>"),group:g("<ul class='#= r.groupCssClass(group) #'#= r.groupAttributes(group) #>#= renderItems(data) #</ul>")},B=i.extend({init:function(b,c){var d=this,e=".k-in:not(.k-state-selected,.k-state-disabled)",f="mouseenter",j,l=!1;h(c)&&(j=!0,c={dataSource:c}),c&&typeof c.loadOnDemand=="undefined"&&h(c.dataSource)&&(c.loadOnDemand=!1),i.prototype.init.call(d,b,c),b=d.element,c=d.options,l=b.is("ul")||b.hasClass(w),l&&(c.dataSource.list=b.is("ul")?b:b.children("ul")),d._animation(),d._accessors(),c.template&&typeof c.template=="string"?c.template=g(c.template):c.template||(c.template=d._textTemplate()),c.checkboxTemplate&&typeof c.checkboxTemplate=="string"&&(c.checkboxTemplate=g(c.checkboxTemplate)),d.templates={item:d._itemTemplate(),loading:d._loadingTemplate()},b.hasClass(w)?(d.wrapper=b,d.root=b.children("ul").eq(0)):(d._wrapper(),l&&(d.root=b,d._group(d.wrapper))),d._dataSource(l),d.wrapper.on(f,".k-in.k-state-selected",function(a){a.preventDefault()}).on(f,e,function(){a(this).addClass(v)}).on("mouseleave",e,function(){a(this).removeClass(v)}).on(t,e,k(d._nodeClick,d)).on("dblclick","div:not(.k-state-disabled) .k-in",k(d._toggleButtonClick,d)).on(t,".k-plus,.k-minus",k(d._toggleButtonClick,d)),c.dragAndDrop&&(d.dragging=new K(d)),l?d._attachUids():c.autoBind&&(d._progress(!0),d.dataSource.read())},_attachUids:function(b,d){var e=this,f,g=c.attr("uid");b=b||e.root,d=d||e.dataSource,f=d.view(),b.children("li").each(function(b,c){c=a(c).attr(g,f[b].uid),e._attachUids(c.children("ul"),f[b].children)})},_animation:function(){var a=this.options;a.animation===!1&&(a.animation={expand:{show:!0,effects:{}},collapse:{hide:!0,effects:{}}})},_dataSource:function(a){function e(a){for(var b=0;b<a.length;b++)a[b].children.read(),e(a[b].children.view())}var b=this,c=b.options,d=c.dataSource;d=h(d)?{data:d}:d,b.dataSource&&b._refreshHandler?b.dataSource.unbind(n,b._refreshHandler):b._refreshHandler=k(b.refresh,b),d.fields||(d.fields=[{field:"text"},{field:"url"},{field:"spriteCssClass"},{field:"imageUrl"}]),b.dataSource=j.create(d),a&&(b.dataSource.read(),e(b.dataSource.view())),b.dataSource.bind(n,b._refreshHandler)},events:[p,q,r,s,m,o,l],options:{name:"TreeView",dataSource:{},animation:{expand:{effects:"expand:vertical",duration:200,show:!0},collapse:{duration:100}},dragAndDrop:!1,autoBind:!0,loadOnDemand:!0},_accessors:function(){var a=this,b=a.options,d,e,f,g=a.element;for(d in E)e=b[E[d]],f=g.attr(c.attr(d+"-field")),f&&(e=f),e||(e=d),h(e)||(e=[e]),b[E[d]]=e},_fieldFor:function(a){var b=this.options[E[a]],c=b.length;return c===0?"'"+a+"'":c==1?"'"+b[0]+"'":"['"+b.join("','")+"']"+"[item.level() < "+c+" ? item.level() : "+(c-1)+"]"},_textTemplate:function(){var a=this,b=function(b){return"item["+a._fieldFor(b)+"]"},c="# var text = "+b("text")+"; #"+"# if (typeof item.encoded != 'undefined' && item.encoded === false) {#"+"#= text #"+"# } else { #"+"#: text #"+"# } #";return g(c)},_loadingTemplate:function(){return g("<div class='k-icon k-loading' /> Loading...")},_itemTemplate:function(){var a=this,b=function(b){return"item["+a._fieldFor(b)+"]"},d="<li class='#= r.wrapperCssClass(group, item) #' "+c.attr("uid")+"='#= item.uid #'"+">"+"<div class='#= r.cssClass(group, item) #'>"+"# if (item.hasChildren) { #"+"<span class='#= r.toggleButtonClass(item) #'></span>"+"# } #"+"# if (treeview.checkboxTemplate) { #"+"<span class='k-checkbox'>"+"#= treeview.checkboxTemplate(data) #"+"</span>"+"# } #"+"# var url = "+b("url")+"; #"+"# var tag = url ? 'a' : 'span'; #"+"# var textAttr = url ? ' href=\\'' + url + '\\'' : ''; #"+"<#=tag# class='#= r.textClass(item) #'#= textAttr #>"+"# var imageUrl = "+b("imageUrl")+"; #"+"# if (imageUrl) { #"+"<img class='k-image' alt='' src='#= imageUrl #'>"+"# } #"+"# var spriteCssClass = "+b("spriteCssClass")+"; #"+"# if (spriteCssClass) { #"+"<span class='k-sprite #= spriteCssClass #'></span>"+"# } #"+"#= treeview.template(data) #"+"</#=tag#>"+"</div>"+"</li>";return g(d)},setOptions:function(a){var b=this;"dragAndDrop"in a&&a.dragAndDrop&&!b.options.dragAndDrop&&(b.dragging=new K(b)),i.fn.setOptions.call(b,a),b._animation()},_trigger:function(a,b){return this.trigger(a,{node:b.closest(y)[0]})},_toggleButtonClick:function(b){this.toggle(a(b.target).closest(y))},_nodeClick:function(b){var c=this,d=a(b.target),e=D(d.closest(y)),f=d.attr("href"),g;f?g=f=="#"||f.indexOf("#"+this.element.id+"-")>=0:g=e.length&&!e.children().length,g&&b.preventDefault(),!d.hasClass(".k-state-selected")&&!c._trigger("select",d)&&c.select(d)},_wrapper:function(){var a=this,b=a.element,c,d,e="k-widget k-treeview k-reset";b.is("div")?(c=b,d=c.children("ul").eq(0)):(c=b.wrap("<div />").parent(),d=b),a.wrapper=c.addClass(e),a.root=d},_group:function(a){var b=this,c=a.hasClass(w),d={firstLevel:c,expanded:c||b._expanded(a)},e=a.children("ul");e.addClass(A.groupCssClass(d)).css("display",d.expanded?"":"none"),b._nodes(e,d)},_nodes:function(b,c){var d=this,e=b.children("li"),g;c=f({length:e.length},c),e.each(function(b,e){e=a(e),g={index:b,expanded:d._expanded(e)},I(e),J(e,c,g),d._group(e)})},_processNodes:function(b,c){var d=this;d.element.find(b).each(function(b,e){c.call(d,b,a(e).closest(y))})},dataItem:function(b){var d=a(b).closest(y).attr(c.attr("uid")),e=this.dataSource;return e&&e.getByUid(d)},_insertNode:function(b,c,d,e,f){var g=this,h=C(d),i=h.children().length+1,j,k={firstLevel:d.hasClass(w),expanded:!f,length:i},l,m,n,o="",p=function(a,b){a.appendTo(b)};for(m=0;m<b.length;m++)n=b[m],n.index=c+m,o+=g._renderItem({group:k,item:n});l=a(o);if(!!l.length){h.length||(h=a(g._renderGroup({group:k})).appendTo(d)),e(l,h),d.hasClass("k-item")&&(I(d),J(d)),J(l.prev()),J(l.next());for(m=0;m<b.length;m++)n=b[m],j=n.children.data(),j.length&&g._insertNode(j,n.index,l.eq(m),p,!g._expanded(l.eq(m)));return l}},refresh:function(a){function j(a,c,d){var e=C(c),f=e.children();typeof g=="undefined"&&(g=f.length),b._insertNode(a,g,c,function(a,b){g==f.length?a.appendTo(b):a.insertBefore(f.eq(g))},d)}var b=this,c=b.wrapper,d=a.node,e=a.action,f=a.items,g=a.index,h=b.options.loadOnDemand,i;if(!a.field){d&&(c=b.findByUid(d.uid),b._progress(c,!1)),e=="add"?j(f,c):e=="remove"?b._remove(b.findByUid(f[0].uid),!1):d?(C(c).empty(),j(f,c,!0),b._expanded(c)&&(J(c,{},{expanded:!0}),C(c).css("display","block"))):b.root=b.wrapper.html(b._renderGroup({items:f,group:{firstLevel:!0,expanded:!0}})).children("ul");if(!h)for(i=0;i<f.length;i++)f[i].load()}},expand:function(a){this._processNodes(a,function(a,b){var c=D(b);c.length>0&&!c.is(x)&&this.toggle(b)})},collapse:function(a){this._processNodes(a,function(a,b){var c=D(b);c.length>0&&c.is(x)&&this.toggle(b)})},enable:function(a,b){b=arguments.length==2?!!b:!0,this._processNodes(a,function(a,c){var d=!D(c).is(x);b||(this.collapse(c),d=!0),J(c,{},{enabled:b,expanded:!d})})},select:function(b){var c=this.element;if(!arguments.length)return c.find(".k-state-selected").closest(y);b=a(b,c).closest(y),b.length&&(c.find(".k-in").removeClass("k-state-hover k-state-selected"),b.find(".k-in:first").addClass("k-state-selected"))},toggle:function(b){b=a(b);if(!!b.find(">div>.k-icon").is(".k-minus,.k-plus,.k-minus-disabled,.k-plus-disabled")){var c=this,d=D(b),e=!d.is(x),g=c.options,h=g.animation||{},i=h.expand,j=f({},h.collapse),k=j&&"effects"in j,l=c.dataItem(b);if(d.data("animating"))return;e||(i=f(k?j:f({reverse:!0},i),{show:!1,hide:!0})),c._trigger(e?"expand":"collapse",b)||(c._expanded(b,e),d.children().length>0?(J(b,{},{expanded:e}),e||d.css("height",d.height()).css("height"),d.kendoStop(!0,!0).kendoAnimate(f(i,{complete:function(){e&&d.css("height","")}}))):l&&(g.loadOnDemand&&c._progress(b,!0),l.load()))}},_expanded:function(a,b){var d=c.attr("expanded"),e=this.dataItem(a);if(arguments.length==1)return a.attr(d)==="true"||e&&e.expanded;e&&e.set("expanded",b),b?a.attr(d,"true"):a.removeAttr(d)},_progress:function(a,b){var c=this.element;arguments.length==1?(b=a,b?c.html(this.templates.loading):c.empty()):a.find("> div > .k-icon").toggleClass("k-loading",b)},text:function(b){return a(b).closest(y).find(">div>.k-in").text()},_dataSourceMove:function(b,d,f,g){var i=this,j=H(b),k,l,m,n,o=H(f||d),p=o.dataSource;f&&(m=o.dataItem(f),m.loaded()||(m.load(),i._expanded(f,!0)),f!=i.root&&(p=m.children));if(b instanceof a||F(b))b=a(b),k=j.dataSource,l=k.getByUid(b.attr(c.attr("uid"))),l=k.remove(l),l=g(p,l);else if(h(b)||b instanceof e.ObservableArray)for(n=0;n<b.length;n++)l=g(p,b[n]);else l=g(p,b);return i.findByUid(l.uid)},insertAfter:function(a,b){var c=b.parent(),d;c.parent().is("li")&&(d=c.parent());return this._dataSourceMove(a,c,d,function(a,c){return a.insert(b.index()+1,c)})},insertBefore:function(a,b){var c=b.parent(),d;c.parent().is("li")&&(d=c.parent());return this._dataSourceMove(a,c,d,function(a,c){return a.insert(b.index(),c)})},append:function(a,b){var c=this,d=c.root;b&&(d=C(b));return c._dataSourceMove(a,d,b,function(a,d){b&&c._expanded(b,!0);return a.add(d)})},_remove:function(b,c){var d,e,f;b=a(b,this.element),d=b.parent().parent(),e=b.prev(),f=b.next(),b[c?"detach":"remove"](),d.hasClass("k-item")&&(I(d),J(d)),J(e),J(f);return b},remove:function(a){var b=this.dataItem(a);b&&this.dataSource.remove(b)},detach:function(a){return this._remove(a,!0)},findByText:function(b){return a(this.element).find(".k-in").filter(function(c,d){return a(d).text()==b}).closest(y)},findByUid:function(a){return this.element.find(".k-item["+c.attr("uid")+"="+a+"]")},_renderItem:function(a){a.group||(a.group={}),a.treeview=this.options,a.r=A;return this.templates.item(a)},_renderGroup:function(a){var b=this;a.renderItems=function(a){var c="",d=0,e=a.items,f=e?e.length:0,g=a.group;g.length=f;for(;d<f;d++)a.group=g,a.item=e[d],a.item.index=d,c+=b._renderItem(a);return c},a.r=A;return z.group(a)}}),K.prototype={_hintStatus:function(b){var c=this._draggable.hint.find(".k-drag-status")[0];if(b)c.className="k-icon k-drag-status "+b;else return a.trim(c.className.replace(/k-(icon|drag-status)/g,""))},dragstart:function(b){var c=this,d=c.treeview,e=c.sourceNode=b.currentTarget.closest(y);d.trigger(p,{sourceNode:e[0]})&&b.preventDefault(),c.dropHint=a("<div class='k-drop-hint' />").css(u,"hidden").appendTo(d.element)},drag:function(b){var d=this,e=d.treeview,f=d.sourceNode,g=d.dropTarget=a(c.eventTarget(b)),h,i,j,k,l,m,n,o,p,r;g.closest(".k-treeview").length?a.contains(f[0],g[0])?h="k-denied":(h="k-insert-middle",d.dropHint.css(u,"visible"),i=g.closest(".k-top,.k-mid,.k-bot"),i.length>0?(k=i.outerHeight(),l=i.offset().top,m=g.closest(".k-in"),n=k/(m.length>0?4:2),o=b.pageY<l+n,p=l+k-n<b.pageY,r=m.length>0&&!o&&!p,m.toggleClass(v,r),d.dropHint.css(u,r?"hidden":"visible"),r?h="k-add":(j=i.position(),j.top+=o?0:k,d.dropHint.css(j)[o?"prependTo":"appendTo"](g.closest(y).children("div:first")),o&&i.hasClass("k-top")&&(h="k-insert-top"),p&&i.hasClass("k-bot")&&(h="k-insert-bottom"))):g[0]!=d.dropHint[0]&&(h="k-denied")):h="k-denied",e.trigger(q,{sourceNode:f[0],dropTarget:g[0],pageY:b.pageY,pageX:b.pageX,statusClass:h.substring(2),setStatusClass:function(a){h=a}}),h.indexOf("k-insert")!==0&&d.dropHint.css(u,"hidden"),d._hintStatus(h)},dragcancel:function(a){this.dropHint.remove()},dragend:function(a){var b=this,c=b.treeview,d="over",e=b.sourceNode,f,g=b.dropHint,h,i;g.css(u)=="visible"?(d=g.prevAll(".k-in").length>0?"after":"before",f=g.closest(y)):b.dropTarget&&(f=b.dropTarget.closest(y)),h=b._hintStatus()!="k-denied",i=c.trigger(r,{sourceNode:e[0],destinationNode:f[0],valid:h,setValid:function(a){h=a},dropTarget:a.target,dropPosition:d}),g.remove();!h||i?b._draggable.dropped=h:(b._draggable.dropped=!0,d=="over"?(c.append(e,f),c.expand(f)):d=="before"?c.insertBefore(e,f):d=="after"&&c.insertAfter(e,f),c.trigger(s,{sourceNode:e[0],destinationNode:f[0],dropPosition:d}))}},A={wrapperCssClass:function(a,b){var c="k-item",d=b.index;a.firstLevel&&d===0&&(c+=" k-first"),d==a.length-1&&(c+=" k-last");return c},cssClass:function(a,b){var c="",d=b.index,e=a.length-1;a.firstLevel&&d===0&&(c+="k-top "),d===0&&d!=e?c+="k-top":d==e?c+="k-bot":c+="k-mid";return c},textClass:function(a){var b="k-in";a.enabled===!1&&(b+=" k-state-disabled"),a.selected===!0&&(b+=" k-state-selected");return b},toggleButtonClass:function(a){var b="k-icon";a.expanded!==!0?b+=" k-plus":b+=" k-minus",a.enabled===!1&&(b+="-disabled");return b},groupAttributes:function(a){return a.expanded!==!0?" style='display:none'":""},groupCssClass:function(a){var b="k-group";a.firstLevel&&(b+=" k-treeview-lines");return b}},d.plugin(B)})(jQuery);