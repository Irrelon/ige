/*
* Kendo UI Web v2012.2.710 (http://kendoui.com)
* Copyright 2012 Telerik AD. All rights reserved.
*
* Kendo UI Web commercial licenses may be obtained at http://kendoui.com/web-license
* If you do not own a commercial license, this file shall be governed by the
* GNU General Public License (GPL) version 3.
* For GPL requirements, please review: http://www.gnu.org/copyleft/gpl.html
*/
;(function(a,b){function bm(a,b){var c,d,e;if(typeof a===U&&a===b)return a;if(j(a)&&a.name===b)return a;if(n(a))for(c=0,d=a.length;c<d;c++){e=a[c];if(typeof e===U&&e===b||e.name===b)return e}return null}function bk(b,d,e,f){var g=b.find(">colgroup"),h,i=l(d,function(a){h=a.width;if(h&&parseInt(h,10)!==0)return c.format('<col style="width:{0}"/>',typeof h===U?h:h+"px");return"<col />"});(e||g.find(".k-hierarchy-col").length)&&i.splice(0,0,'<col class="k-hierarchy-col" />'),g.length&&g.remove(),g=a("<colgroup/>").append(a(Array(f+1).join('<col class="k-group-col">')+i.join(""))),b.prepend(g)}function bj(a){a=a||{};var b=a.style;b&&(a.style=b.replace(/((.*)?)(display\s*:\s*none)\s*;?/i,"$1"));return a}function bi(a){a=a||{};var b=a.style;b?(b=b.replace(/((.*)?display)(.*)?:([^;]*)/i,"$1:none"),b===a.style&&(b=b.replace(/(.*)?/i,"display:none;$1"))):b="display:none";return k({},a,{style:b})}function bh(a){return m(a,function(a){return!a.hidden})}function bg(a,b,c){var d,e,f,g;c=n(c)?c:[c];for(d=0,e=c.length;d<e;d++)f=c[d],j(f)&&f.click&&(g=f.name||f.text,b.on(Q,"a.k-grid-"+g,{commandName:g},p(f.click,a)))}function bf(a,b,c){var d=a.eq(b),e=a.eq(c);d[b>c?"insertBefore":"insertAfter"](e)}function be(a){var b,c,d={},e={};if(!r(a)){n(a)||(a=[a]);for(b=0,c=a.length;b<c;b++)d[a[b].aggregate]=0,e[a[b].field]=d}return e}function bd(b,c){a("th, th .k-grid-filter, th .k-link",b).add(document.body).css("cursor",c)}function bc(b){var c=0;a("> .k-grouping-header, > .k-grid-toolbar",b).each(function(){c+=this.offsetHeight});return c}function ba(a){var b,c=" ";if(a){if(typeof a===U)return a;for(b in a)c+=b+'="'+a[b]+'"'}return c}function _(a){return Array(a+1).join('<td class="k-group-cell">&nbsp;</td>')}var c=window.kendo,d=c.ui,e=c.data.DataSource,f=d.Groupable,g=c.support.tbodyInnerHtml,h=d.Widget,i=c.keys,j=a.isPlainObject,k=a.extend,l=a.map,m=a.grep,n=a.isArray,o=a.inArray,p=a.proxy,q=a.isFunction,r=a.isEmptyObject,s=Math,t="requestStart",u="error",v="tbody>tr:not(.k-grouping-row,.k-detail-row,.k-group-footer):visible",w=":not(.k-group-cell,.k-hierarchy-cell):visible",x="tbody>tr:not(.k-grouping-row,.k-detail-row,.k-group-footer) > td:not(.k-group-cell,.k-hierarchy-cell)",y=v+">td"+w,z=y+":first",A="edit",B="save",C="remove",D="detailInit",E="change",F="columnHide",G="columnShow",H="saveChanges",I="dataBound",J="detailExpand",K="detailCollapse",L="k-state-focused",M="k-focusable",N="k-state-selected",O="columnResize",P="columnReorder",Q="click",R="height",S="tabIndex",T="function",U="string",V="Are you sure you want to delete this record?",W=/(\}|\#)/ig,X=3,Y=/#/ig,Z='<a class="k-button k-button-icontext #=className#" #=attr# href="\\#"><span class="#=iconClass# #=imageClass#"></span>#=text#</a>',$=h.extend({init:function(a,b){var c=this;h.fn.init.call(c,a,b),c._refreshHandler=p(c.refresh,c),c.setDataSource(b.dataSource),c.wrap()},setDataSource:function(a){var b=this;b.dataSource&&b.dataSource.unbind(E,b._refreshHandler),b.dataSource=a,b.dataSource.bind(E,b._refreshHandler)},options:{name:"VirtualScrollable",itemHeight:a.noop},wrap:function(){var b=this,d=c.support.scrollbar()+1,e=b.element;e.css({width:"auto",paddingRight:d,overflow:"hidden"}),b.content=e.children().first(),b.wrapper=b.content.wrap('<div class="k-virtual-scrollable-wrap"/>').parent().bind("DOMMouseScroll",p(b._wheelScroll,b)).bind("mousewheel",p(b._wheelScroll,b)),c.support.touch&&(b.drag=new c.Drag(b.wrapper,{global:!0,move:function(a){b.verticalScrollbar.scrollTop(b.verticalScrollbar.scrollTop()-a.y.delta),a.preventDefault()}})),b.verticalScrollbar=a('<div class="k-scrollbar k-scrollbar-vertical" />').css({width:d}).appendTo(e).bind("scroll",p(b._scroll,b))},_wheelScroll:function(b){var c=this,d=c.verticalScrollbar.scrollTop(),e=b.originalEvent,f;b.preventDefault(),e.wheelDelta?f=e.wheelDelta:e.detail?f=-e.detail*10:a.browser.opera&&(f=-e.wheelDelta),c.verticalScrollbar.scrollTop(d+ -f)},_scroll:function(a){var b=this,c=a.currentTarget.scrollTop,d=b.dataSource,e=b.itemHeight,f=d.skip()||0,g=b._rangeStart||f,h=b.element.innerHeight(),i=!!(b._scrollbarTop&&b._scrollbarTop>c),j=s.max(s.floor(c/e),0),k=s.max(j+s.floor(h/e),0);b._scrollTop=c-g*e,b._scrollbarTop=c,b._fetch(j,k,i)||(b.wrapper[0].scrollTop=b._scrollTop)},_fetch:function(a,b,c){var d=this,e=d.dataSource,f=d.itemHeight,g=e.take(),h=d._rangeStart||e.skip()||0,i=s.floor(a/g)*g,j=!1,k=.33;a<h?(j=!0,h=s.max(0,b-g),d._scrollTop=(a-h)*f,d._page(h,g)):b>=h+g&&!c?(j=!0,h=a,d._scrollTop=f,d._page(h,g)):d._fetching||(a<i+g-g*k&&a>g&&e.prefetch(i-g,g),b>i+g*k&&e.prefetch(i+g,g));return j},_page:function(a,b){var d=this,e=d.dataSource;clearTimeout(d._timeout),d._fetching=!0,d._rangeStart=a,e.inRange(a,b)?e.range(a,b):(c.ui.progress(d.wrapper.parent(),!0),d._timeout=setTimeout(function(){e.range(a,b)},100))},refresh:function(){var a=this,b="",d=25e4,e=a.dataSource,f=a._rangeStart,g=c.support.scrollbar(),h=a.wrapper[0],i,j,k;c.ui.progress(a.wrapper.parent(),!1),clearTimeout(a._timeout),k=a.itemHeight=a.options.itemHeight()||0;var l=h.scrollWidth>h.offsetWidth?g:0;i=e.total()*k+l;for(j=0;j<s.floor(i/d);j++)b+='<div style="width:1px;height:'+d+'px"></div>';i%d&&(b+='<div style="width:1px;height:'+i%d+'px"></div>'),a.verticalScrollbar.html(b),h.scrollTop=a._scrollTop,a.drag&&a.drag.cancel(),f&&!a._fetching&&(a._rangeStart=e.skip()),a._fetching=!1}}),bb={create:{text:"Add new record",imageClass:"k-add",className:"k-grid-add",iconClass:"k-icon"},cancel:{text:"Cancel changes",imageClass:"k-cancel",className:"k-grid-cancel-changes",iconClass:"k-icon"},save:{text:"Save changes",imageClass:"k-update",className:"k-grid-save-changes",iconClass:"k-icon"},destroy:{text:"Delete",imageClass:"k-delete",className:"k-grid-delete",iconClass:"k-icon"},edit:{text:"Edit",imageClass:"k-edit",className:"k-grid-edit",iconClass:"k-icon"},update:{text:"Update",imageClass:"k-update",className:"k-grid-update",iconClass:"k-icon"},canceledit:{text:"Cancel",imageClass:"k-cancel",className:"k-grid-cancel",iconClass:"k-icon"}},bl=h.extend({init:function(a,b){var d=this;b=n(b)?{dataSource:b}:b,h.fn.init.call(d,a,b),d._element(),d._columns(d.options.columns),d._dataSource(),d._tbody(),d._pageable(),d._thead(),d._groupable(),d._toolbar(),d._setContentHeight(),d._templates(),d._navigatable(),d._selectable(),d._details(),d._editable(),d._attachCustomCommandsEvent(),d.options.autoBind&&d.dataSource.fetch(),c.notify(d)},events:[E,"dataBinding",I,J,K,D,A,B,C,H,O,P,G,F],setDataSource:function(a){var b=this;b.options.dataSource=a,b._dataSource(),b._pageable(),b.options.groupable&&b._groupable(),b._thead(),b.virtualScrollable&&b.virtualScrollable.setDataSource(b.options.dataSource),b.options.autoBind&&a.fetch()},options:{name:"Grid",columns:[],toolbar:null,autoBind:!0,filterable:!1,scrollable:!0,sortable:!1,selectable:!1,navigatable:!1,pageable:!1,editable:!1,groupable:!1,rowTemplate:"",altRowTemplate:"",dataSource:{},height:null,resizable:!1,reorderable:!1,columnMenu:!1},setOptions:function(a){var b=this;h.fn.setOptions.call(this,a),b._templates()},items:function(){return this.tbody.children(":not(.k-grouping-row,.k-detail-row,.k-group-footer)")},_attachCustomCommandsEvent:function(){var a=this,b=a.columns||[],c,d,e;for(d=0,e=b.length;d<e;d++)c=b[d].command,c&&bg(a,a.wrapper,c)},_element:function(){var b=this,c=b.element;c.is("table")||(b.options.scrollable?c=b.element.find("> .k-grid-content > table"):c=b.element.children("table"),c.length||(c=a("<table />").appendTo(b.element))),b.table=c.attr("cellspacing",0),b._wrapper()},_positionColumnResizeHandle:function(b){var c=this,d=c.options.scrollable,e=c.resizeHandle,f;c.thead.on("mousemove","th:not(.k-group-cell,.k-hierarchy-cell)",function(g){var h=a(this),i=h.offset().left+this.offsetWidth;g.clientX>i-X&&g.clientX<i+X?(bd(c.wrapper,h.css("cursor")),e||(e=c.resizeHandle=a('<div class="k-resize-handle"/>'),b.append(e)),f=this.offsetWidth,h.prevAll().each(function(){f+=this.offsetWidth}),e.css({top:d?0:bc(c.wrapper),left:f-X,height:h.outerHeight(),width:X*3}).data("th",h).show()):(bd(c.wrapper,""),e&&e.hide())})},_resizable:function(){var b=this,c=b.options,d,e,f,g,h;c.resizable&&(d=c.scrollable?b.wrapper.find(".k-grid-header-wrap"):b.wrapper,b._positionColumnResizeHandle(d),d.kendoResizable({handle:".k-resize-handle",hint:function(c){return a('<div class="k-grid-resize-indicator" />').css({height:c.data("th").outerHeight()+b.tbody.attr("clientHeight")})},start:function(d){var i=a(d.currentTarget).data("th"),j=a.inArray(i[0],i.parent().children(":visible")),k=b.tbody.parent(),l=b.footer||a();bd(b.wrapper,i.css("cursor")),c.scrollable?h=b.thead.parent().find("col:eq("+j+")").add(k.children("colgroup").find("col:eq("+j+")")).add(l.find("colgroup").find("col:eq("+j+")")):h=k.children("colgroup").find("col:eq("+j+")"),e=d.x.location,f=i.outerWidth(),g=b.tbody.outerWidth()},resize:function(d){var i=f+d.x.location-e,j=b.footer||a();i>10&&(h.css("width",i),c.scrollable&&(b._footerWidth=g+d.x.location-e,b.tbody.parent().add(b.thead.parent()).add(j.find("table")).css("width",b._footerWidth)))},resizeend:function(c){var d=a(c.currentTarget).data("th"),e=d.outerWidth(),g;bd(b.wrapper,""),f!=e&&(g=b.columns[d.parent().find("th:not(.k-group-cell,.k-hierarchy-cell)").index(d)],g.width=e,b.trigger(O,{column:g,oldWidth:f,newWidth:e})),b.resizeHandle.hide()}}))},_draggable:function(){var b=this;b.options.reorderable&&(b._draggableInstance=b.thead.kendoDraggable({group:c.guid(),filter:".k-header:not(.k-group-cell,.k-hierarchy-cell):visible["+c.attr("field")+"]",hint:function(b){return a('<div class="k-header k-drag-clue" />').css({width:b.width(),paddingLeft:b.css("paddingLeft"),paddingRight:b.css("paddingRight"),lineHeight:b.height()+"px",paddingTop:b.css("paddingTop"),paddingBottom:b.css("paddingBottom")}).html(b.attr(c.attr("title"))||b.attr(c.attr("field"))).prepend('<span class="k-icon k-drag-status k-denied" />')}}).data("kendoDraggable"))},_reorderable:function(){var a=this;a.options.reorderable&&a.thead.kendoReorderable({draggable:a._draggableInstance,change:function(b){var c=bh(a.columns)[b.oldIndex];a.trigger(P,{newIndex:b.newIndex,oldIndex:b.oldIndex,column:c}),a.reorderColumn(b.newIndex,c)}})},reorderColumn:function(b,c){var d=this,e=a.inArray(c,d.columns),f=a.inArray(c,bh(d.columns)),g,h,i,j=d.footer||d.wrapper.find(".k-grid-footer");if(e!==b){d.columns.splice(e,1),d.columns.splice(b,0,c),d._templates(),bf(d.thead.prev().find("col:not(.k-group-col,.k-hierarchy-col)"),f,b),d.options.scrollable&&bf(d.tbody.prev().find("col:not(.k-group-col,.k-hierarchy-col)"),f,b),bf(d.thead.find(".k-header:not(.k-group-cell,.k-hierarchy-cell)"),e,b),j&&j.length&&(bf(j.find(".k-grid-footer-wrap>table>colgroup>col:not(.k-group-col,.k-hierarchy-col)"),f,b),bf(j.find(".k-footer-template>td:not(.k-group-cell,.k-hierarchy-cell)"),e,b)),g=d.tbody.children(":not(.k-grouping-row,.k-detail-row)");for(h=0,i=g.length;h<i;h+=1)bf(g.eq(h).find(">td:not(.k-group-cell,.k-hierarchy-cell)"),e,b)}},cellIndex:function(b){return a(b).parent().find("td:not(.k-group-cell,.k-hierarchy-cell)").index(b)},_modelForContainer:function(b){b=a(b),!b.is("tr")&&this._editMode()!=="popup"&&(b=b.closest("tr"));var d=b.attr(c.attr("uid"));return this.dataSource.getByUid(d)},_editable:function(){var b=this,c=b.options.editable,d=function(){var c=document.activeElement,d=b._editContainer;d&&!a.contains(d[0],c)&&d[0]!==c&&!a(c).closest(".k-animation-container").length&&b.editable.end()&&b.closeCell()};if(c){var e=b._editMode();e==="incell"?c.update!==!1&&(b.wrapper.delegate("tr:not(.k-grouping-row) > td:not(.k-hierarchy-cell,.k-detail-cell,.k-group-cell,.k-edit-cell,:has(a.k-grid-delete))",Q,function(c){var d=a(this);d.closest("tbody")[0]===b.tbody[0]&&!a(c.target).is(":input")&&(b.editable?b.editable.end()&&(b.closeCell(),b.editCell(d)):b.editCell(d))}),b.wrapper.bind("focusin",function(a){clearTimeout(b.timer),b.timer=null}),b.wrapper.bind("focusout",function(a){b.timer=setTimeout(d,1)})):c.update!==!1&&b.wrapper.delegate("tbody>tr:not(.k-detail-row,.k-grouping-row):visible a.k-grid-edit",Q,function(c){c.preventDefault(),b.editRow(a(this).closest("tr"))}),c.destroy!==!1&&b.wrapper.delegate("tbody>tr:not(.k-detail-row,.k-grouping-row):visible a.k-grid-delete",Q,function(c){c.preventDefault(),b.removeRow(a(this).closest("tr"))})}},editCell:function(a){var b=this,c=b.columns[b.cellIndex(a)],d=b._modelForContainer(a);d&&(!d.editable||d.editable(c.field))&&!c.command&&c.field&&(b._attachModelChange(d),b._editContainer=a,b.editable=a.addClass("k-edit-cell").kendoEditable({fields:{field:c.field,format:c.format,editor:c.editor,values:c.values},model:d,change:function(c){b.trigger(B,{values:c.values,container:a,model:d})&&c.preventDefault()}}).data("kendoEditable"),a.parent().addClass("k-grid-edit-row"),b.trigger(A,{container:a,model:d}))},_destroyEditable:function(){var a=this;a.editable&&(a._detachModelChange(),a.editable.destroy(),delete a.editable,a._editMode()==="popup"&&a._editContainer.data("kendoWindow").close(),a._editContainer=null)},_attachModelChange:function(a){var b=this;b._modelChangeHandler=function(a){b._modelChange({field:a.field,model:this})},a.bind("change",b._modelChangeHandler)},_detachModelChange:function(){var a=this,b=a._editContainer,c=a._modelForContainer(b);c&&c.unbind(E,a._modelChangeHandler)},closeCell:function(){var b=this,d=b._editContainer.removeClass("k-edit-cell"),e=d.closest("tr").attr(c.attr("uid")),f=b.columns[b.cellIndex(d)],g=b.dataSource.getByUid(e);d.parent().removeClass("k-grid-edit-row"),b._destroyEditable(),b._displayCell(d,f,g),d.hasClass("k-dirty-cell")&&a('<span class="k-dirty"/>').prependTo(d)},_displayCell:function(a,b,d){var e=this,f={storage:{},count:0},g=k({},c.Template,e.options.templateSettings),h=c.template(e._cellTmpl(b,f),g);f.count>0&&(h=p(h,f.storage)),a.empty().html(h(d))},removeRow:function(b){var c=this,d,e;!c._confirmation()||(b=a(b).hide(),d=c._modelForContainer(b),d&&!c.trigger(C,{row:b,model:d})&&(c.dataSource.remove(d),e=c._editMode(),(e==="inline"||e==="popup")&&c.dataSource.sync()))},_editMode:function(){var a="incell",b=this.options.editable;b!==!0&&(typeof b=="string"?a=b:a=b.mode||a);return a},editRow:function(b){var c=this,d=c._modelForContainer(b),e=c._editMode(),f;c.cancelRow(),d&&(c._attachModelChange(d),e==="popup"?c._createPopupEditor(d):e==="inline"?c._createInlineEditor(b,d):e==="incell"&&a(b).children(w).each(function(){var b=a(this),e=c.columns[b.index()];d=c._modelForContainer(b);if(d&&(!d.editable||d.editable(e.field))&&e.field){c.editCell(b);return!1}}),f=c._editContainer,f.delegate("a.k-grid-cancel",Q,function(a){a.preventDefault(),c.cancelRow()}),f.delegate("a.k-grid-update",Q,function(a){a.preventDefault(),c.saveRow()}))},_createPopupEditor:function(b){var d=this,e="<div "+c.attr("uid")+'="'+b.uid+'"><div class="k-edit-form-container">',f,g,h=[],i,l,m,n,o,q,r=d.options.editable,s=j(r)?r.window:{},t=k({},c.Template,d.options.templateSettings);if(r.template){e+=c.template(window.unescape(r.template),t)(b);for(i=0,l=d.columns.length;i<l;i++)f=d.columns[i],f.command&&(g=bm(f.command,"edit"))}else for(i=0,l=d.columns.length;i<l;i++){f=d.columns[i];if(!f.command){e+='<div class="k-edit-label"><label for="'+f.field+'">'+(f.title||f.field||"")+"</label></div>";if((!b.editable||b.editable(f.field))&&f.field)h.push({field:f.field,format:f.format,editor:f.editor,values:f.values}),e+="<div "+c.attr("container-for")+'="'+f.field+'" class="k-edit-field"></div>';else{var u={storage:{},count:0};m=c.template(d._cellTmpl(f,u),t),u.count>0&&(m=p(m,u.storage)),e+='<div class="k-edit-field">'+m(b)+"</div>"}}else f.command&&(g=bm(f.command,"edit"))}g&&j(g)&&(g.text&&j(g.text)&&(n=g.text.update,o=g.text.cancel),g.attr&&(q=g.attr)),e+=d._createButton({name:"update",text:n,attr:q})+d._createButton({name:"canceledit",text:o,attr:q}),e+="</div></div>";var v=d._editContainer=a(e).appendTo(d.wrapper).eq(0).kendoWindow(k({modal:!0,resizable:!1,draggable:!0,title:"Edit",visible:!1},s)),w=v.data("kendoWindow");w.wrapper.delegate(".k-i-close","click",function(){d.cancelRow()}),d.editable=d._editContainer.kendoEditable({fields:h,model:b,clearContainer:!1}).data("kendoEditable"),w.center().open(),d.trigger(A,{container:v,model:b})},_createInlineEditor:function(b,c){var d=this,e,f,g,h=[];b.children(":not(.k-group-cell,.k-hierarchy-cell)").each(function(){f=a(this),e=d.columns[d.cellIndex(f)];if(!e.command&&e.field&&(!c.editable||c.editable(e.field)))h.push({field:e.field,format:e.format,editor:e.editor,values:e.values}),f.attr("data-container-for",e.field),f.empty();else if(e.command){g=bm(e.command,"edit");if(g){f.empty();var b,i,k;j(g)&&(g.text&&j(g.text)&&(b=g.text.update,i=g.text.cancel),g.attr&&(k=g.attr)),a(d._createButton({name:"update",text:b,attr:k})+d._createButton({name:"canceledit",text:i,attr:k})).appendTo(f)}}}),d._editContainer=b,d.editable=b.addClass("k-grid-edit-row").kendoEditable({fields:h,model:c,clearContainer:!1}).data("kendoEditable"),d.trigger(A,{container:b,model:c})},cancelRow:function(){var a=this,b=a._editContainer,d;b&&(d=a._modelForContainer(b),a.dataSource.cancelChanges(d),a._editMode()!=="popup"?a._displayRow(b):a._displayRow(a.items().filter("["+c.attr("uid")+"="+d.uid+"]")),a._destroyEditable())},saveRow:function(){var a=this,b=a._editContainer,c=a._modelForContainer(b),d=a.editable;b&&d&&d.end()&&!a.trigger(B,{container:b,model:c})&&(a._editMode()!=="popup"&&a._displayRow(b),a._destroyEditable(),a.dataSource.sync())},_displayRow:function(b){var c=this,d=c._modelForContainer(b);d&&b.replaceWith(a((b.hasClass("k-alt")?c.altRowTemplate:c.rowTemplate)(d)))},_showMessage:function(a){return window.confirm(a)},_confirmation:function(){var a=this,b=a.options.editable,c=b===!0||typeof b===U?V:b.confirmation;return c!==!1&&c!=null?a._showMessage(c):!0},cancelChanges:function(){this.dataSource.cancelChanges()},saveChanges:function(){var a=this;(a.editable&&a.editable.end()||!a.editable)&&!a.trigger(H)&&a.dataSource.sync()},addRow:function(){var a=this,b,d=a.dataSource,e=a._editMode(),f=a.options.editable.createAt||"",g=d.pageSize(),h=d.view()||[];if(a.editable&&a.editable.end()||!a.editable){e!="incell"&&a.cancelRow(),b=d.indexOf(h[0]),f.toLowerCase()=="bottom"&&(b+=h.length,g&&!d.options.serverPaging&&g<=h.length&&(b-=1)),b<0&&(b=0);var i=d.insert(b,{}),j=i.uid,k=a.table.find("tr["+c.attr("uid")+"="+j+"]"),l=k.children("td:not(.k-group-cell,.k-hierarchy-cell)").first();e!=="inline"&&e!=="popup"||!k.length?l.length&&a.editCell(l):a.editRow(k)}},_toolbar:function(){var b=this,d=b.wrapper,e=b.options.toolbar,f=b.options.editable,g,h;e&&(g=b.wrapper.find(".k-grid-toolbar"),g.length||(e=q(e)?e({}):typeof e===U?e:b._toolbarTmpl(e).replace(Y,"\\#"),h=p(c.template(e),b),g=a('<div class="k-toolbar k-grid-toolbar" />').html(h({})).prependTo(d)),f&&f.create!==!1&&g.delegate(".k-grid-add",Q,function(a){a.preventDefault(),b.addRow()}).delegate(".k-grid-cancel-changes",Q,function(a){a.preventDefault(),b.cancelChanges()}).delegate(".k-grid-save-changes",Q,function(a){a.preventDefault(),b.saveChanges()}))},_toolbarTmpl:function(a){var b=this,c,d,e="";if(n(a))for(c=0,d=a.length;c<d;c++)e+=b._createButton(a[c]);return e},_createButton:function(a){var b=a.template||Z,d=typeof a===U?a:a.name||a.text,e={className:"k-grid-"+d,text:d,imageClass:"",attr:"",iconClass:""};if(!d&&(!j(a)||!a.template))throw new Error("Custom commands should have name specified");j(a)?(a.className&&(a.className+=" "+e.className),d==="edit"&&j(a.text)&&(a=k(!0,{},a),a.text=a.text.edit),a.attr&&j(a.attr)&&(a.attr=ba(a.attr)),e=k(!0,e,bb[d],a)):e=k(!0,e,bb[d]);return c.template(b)(e)},_groupable:function(){var b=this,d=b.wrapper,e=b.options.groupable;b.groupable||b.table.delegate(".k-grouping-row .k-i-collapse, .k-grouping-row .k-i-expand",Q,function(c){var d=a(this),e=d.closest("tr");d.hasClass("k-i-collapse")?b.collapseGroup(e):b.expandGroup(e),c.preventDefault(),c.stopPropagation()}),e&&(d.has("div.k-grouping-header")[0]||a("<div />").addClass("k-grouping-header").html("&nbsp;").prependTo(d),b.groupable&&b.groupable.destroy(),b.groupable=new f(d,k({},e,{draggable:b._draggableInstance,groupContainer:">div.k-grouping-header",dataSource:b.dataSource,filter:".k-header:not(.k-group-cell,.k-hierarchy-cell):visible["+c.attr("field")+"]",allowDrag:b.options.reorderable})))},_selectable:function(){var a=this,b,d,e=a.options.selectable;e&&(b=typeof e===U&&e.toLowerCase().indexOf("multiple")>-1,d=typeof e===U&&e.toLowerCase().indexOf("cell")>-1,a.selectable=new c.ui.Selectable(a.table,{filter:">"+(d?x:"tbody>tr:not(.k-grouping-row,.k-detail-row,.k-group-footer)"),multiple:b,change:function(){a.trigger(E)}}),a.options.navigatable&&a.wrapper.keydown(function(c){var e=a.current();c.keyCode===i.SPACEBAR&&c.target==a.wrapper[0]&&!e.hasClass("k-edit-cell")&&(c.preventDefault(),c.stopPropagation(),e=d?e:e.parent(),b?c.ctrlKey?e.hasClass(N)&&(e.removeClass(N),e=null):a.selectable.clear():a.selectable.clear(),a.selectable.value(e))}))},clearSelection:function(){var a=this;a.selectable.clear(),a.trigger(E)},select:function(b){var c=this,d=c.selectable;b=a(b);if(b.length)d.options.multiple||(d.clear(),b=b.first()),d.value(b);else return d.value()},current:function(a){var c=this,d=c.options.scrollable,e=c._current;a!==b&&a.length&&(!e||e[0]!==a[0])&&(a.addClass(L),e&&e.removeClass(L),c._current=a,a.length&&d&&(c._scrollTo(a.parent()[0],c.content[0]),d.virtual?c._scrollTo(a[0],c.content.find(">.k-virtual-scrollable-wrap")[0]):c._scrollTo(a[0],c.content[0])));return c._current},_scrollTo:function(a,b){var c=a.tagName.toLowerCase()==="td",d=a[c?"offsetLeft":"offsetTop"],e=a[c?"offsetWidth":"offsetHeight"],f=b[c?"scrollLeft":"scrollTop"],g=b[c?"clientWidth":"clientHeight"],h=d+e;b[c?"scrollLeft":"scrollTop"]=f>d?d:h>f+g?h-g:f},_navigatable:function(){var b=this,c=b.wrapper,d=b.table.addClass(M),e=p(b.current,b),f="."+M+" "+y,g=a.browser,h=function(d){var f=a(d.currentTarget);f.closest("tbody")[0]===b.tbody[0]&&(e(f),a(d.target).is(":button,a,:input,a>.k-icon,textarea,span.k-icon,.k-input")||setTimeout(function(){c.focus()}),d.stopPropagation())};b.options.navigatable&&(c.bind({focus:function(){var a=b._current;a&&a.is(":visible")?a.addClass(L):e(b.table.find(z))},focusout:function(a){b._current&&b._current.removeClass(L),a.stopPropagation()},keydown:function(f){var h=f.keyCode,j=b.current(),k=f.shiftKey,l=b.dataSource,m=b.options.pageable,n=!a(f.target).is(":button,a,:input,a>.t-icon"),o=b._editMode()=="incell",p,q,r=!1;n&&i.UP===h?(e(j?j.parent().prevAll(v).last().children(":eq("+j.index()+"),:eq(0)").last():d.find(z)),r=!0):n&&i.DOWN===h?(e(j?j.parent().nextAll(v).first().children(":eq("+j.index()+"),:eq(0)").last():d.find(z)),r=!0):n&&i.LEFT===h?(e(j?j.prevAll(w+":first"):d.find(z)),r=!0):n&&i.RIGHT===h?(e(j?j.nextAll(":visible:first"):d.find(z)),r=!0):n&&m&&i.PAGEDOWN==h?(b._current=null,l.page(l.page()+1),r=!0):n&&m&&i.PAGEUP==h?(b._current=null,l.page(l.page()-1),r=!0):b.options.editable&&(j=j?j:d.find(z),i.ENTER==h||i.F2==h?(b._handleEditing(j),r=!0):i.TAB==h&&o?(q=k?j.prevAll(w+":first"):j.nextAll(":visible:first"),q.length||(q=j.parent()[k?"prevAll":"nextAll"]("tr:not(.k-grouping-row,.k-detail-row):visible").children(w+(k?":last":":first"))),q.length&&(b._handleEditing(j,q),r=!0)):i.ESC==h&&b._editContainer&&(b._editContainer.has(j[0])||j[0]===b._editContainer[0])&&(o?b.closeCell():(p=b.items().index(j.parent()),document.activeElement.blur(),b.cancelRow(),p>=0&&b.current(b.items().eq(p).children().filter(w).first())),g.msie&&parseInt(g.version,10)<9&&document.body.focus(),c.focus(),r=!0)),r&&(f.preventDefault(),f.stopPropagation())}}),c.delegate(f,"mousedown",h))},_handleEditing:function(b,c){var d=this,e=d._editMode(),f=d._editContainer,g,h;e=="incell"?h=b.hasClass("k-edit-cell"):h=b.parent().hasClass("k-grid-edit-row");if(d.editable){a.contains(f[0],document.activeElement)&&a(document.activeElement).blur();if(d.editable.end())e=="incell"?d.closeCell():(b.parent()[0]===f[0]?g=d.items().index(b.parent()):g=d.items().index(f),d.saveRow(),d.current(d.items().eq(g).children().filter(w).first()),h=!0);else{e=="incell"?d.current(f):d.current(f.children().filter(w).first()),f.find(":input:visible:first").focus();return}}c&&d.current(c),d.wrapper.focus();if(!h&&!c||c)e=="incell"?d.editCell(d.current()):d.editRow(d.current().parent())},_wrapper:function(){var a=this,b=a.table,c=a.options.height,d=a.element;d.is("div")||(d=d.wrap("<div/>").parent()),a.wrapper=d.addClass("k-grid k-widget").attr(S,s.max(b.attr(S)||0,0)),b.removeAttr(S),c&&(a.wrapper.css(R,c),b.css(R,"auto"))},_tbody:function(){var b=this,c=b.table,d;d=c.find(">tbody"),d.length||(d=a("<tbody/>").appendTo(c)),b.tbody=d},_scrollable:function(){var b=this,d,e,f=b.options,g=f.scrollable,h=c.support.scrollbar();if(g){d=b.wrapper.children(".k-grid-header"),d[0]||(d=a('<div class="k-grid-header" />').insertBefore(b.table)),d.css("padding-right",g.virtual?h+1:h),e=a('<table cellspacing="0" />'),e.append(b.thead),d.empty().append(a('<div class="k-grid-header-wrap" />').append(e)),b.content=b.table.parent(),b.content.is(".k-virtual-scrollable-wrap")&&(b.content=b.content.parent()),b.content.is(".k-grid-content, .k-virtual-scrollable-wrap")||(b.content=b.table.wrap('<div class="k-grid-content" />').parent()),g!==!0&&g.virtual&&!b.virtualScrollable&&(b.virtualScrollable=new $(b.content,{dataSource:b.dataSource,itemHeight:p(b._averageRowHeight,b)})),b.scrollables=d.children(".k-grid-header-wrap");if(g.virtual)b.content.find(">.k-virtual-scrollable-wrap").bind("scroll",function(){b.scrollables.scrollLeft(this.scrollLeft)});else{b.content.bind("scroll",function(){b.scrollables.scrollLeft(this.scrollLeft)});var i=c.touchScroller(b.content);i&&i.movable&&i.movable.bind("change",function(a){b.scrollables.scrollLeft(-a.sender.x)})}}},_setContentHeight:function(){var a=this,b=a.options,d=a.wrapper.innerHeight(),e=a.wrapper.children(".k-grid-header"),f=c.support.scrollbar();if(b.scrollable){d-=e.outerHeight(),a.pager&&(d-=a.pager.element.outerHeight()),b.groupable&&(d-=a.wrapper.children(".k-grouping-header").outerHeight()),b.toolbar&&(d-=a.wrapper.children(".k-grid-toolbar").outerHeight()),a.footerTemplate&&(d-=a.wrapper.children(".k-grid-footer").outerHeight());var g=function(a){var b,c;if(a[0].style.height)return!0;b=a.height(),a.height("auto"),c=a.height();if(b!=c){a.height("");return!0}a.height("");return!1};g(a.wrapper)&&(d>f*2?a.content.height(d):a.content.height(f*2+1))}},_averageRowHeight:function(){var a=this,b=a._rowHeight;a._rowHeight||(a._rowHeight=b=a.table.outerHeight()/a.table[0].rows.length,a._sum=b,a._measures=1);var c=a.table.outerHeight()/a.table[0].rows.length;b!==c&&(a._measures++,a._sum+=c,a._rowHeight=a._sum/a._measures);return b},_dataSource:function(){var a=this,c=a.options,d,f=c.dataSource;f=n(f)?{data:f}:f,j(f)&&(k(f,{table:a.table,fields:a.columns}),d=c.pageable,j(d)&&d.pageSize!==b&&(f.pageSize=d.pageSize)),a.dataSource&&a._refreshHandler?a.dataSource.unbind(E,a._refreshHandler).unbind(t,a._requestStartHandler).unbind(u,a._errorHandler):(a._refreshHandler=p(a.refresh,a),a._requestStartHandler=p(a._requestStart,a),a._errorHandler=p(a._error,a)),a.dataSource=e.create(f).bind(E,a._refreshHandler).bind(t,a._requestStartHandler).bind(u,a._errorHandler)},_error:function(){this._progress(!1)},_requestStart:function(){this._progress(!0)},_modelChange:function(b){var e=this,f=b.model,g=e.tbody.find("tr["+c.attr("uid")+"="+f.uid+"]"),h,i,j=g.hasClass("k-alt"),k,l,m;if(g.children(".k-edit-cell").length&&!e.options.rowTemplate)g.children(":not(.k-group-cell,.k-hierarchy-cell)").each(function(){h=a(this),i=e.columns[e.cellIndex(h)],i.field===b.field&&(h.hasClass("k-edit-cell")?h.addClass("k-dirty-cell"):(e._displayCell(h,i,f),a('<span class="k-dirty"/>').prependTo(h)))});else if(!g.hasClass("k-grid-edit-row")){k=a((j?e.altRowTemplate:e.rowTemplate)(f)),g.replaceWith(k);for(l=0,m=e.columns.length;l<m;l++)i=e.columns[l],i.field===b.field&&(h=k.children(":not(.k-group-cell,.k-hierarchy-cell)").eq(l),a('<span class="k-dirty"/>').prependTo(h));e.trigger("itemChange",{item:k,data:f,ns:d})}},_pageable:function(){var b=this,d,e=b.options.pageable;e&&(d=b.wrapper.children("div.k-grid-pager"),d.length||(d=a('<div class="k-pager-wrap k-grid-pager"/>').appendTo(b.wrapper)),b.pager&&b.pager.destroy(),typeof e=="object"&&e instanceof c.ui.Pager?b.pager=e:b.pager=new c.ui.Pager(d,k({},e,{dataSource:b.dataSource})))},_footer:function(){var b=this,c=b.dataSource.aggregates(),d="",e=b.footerTemplate,f=b.options,g;if(e){c=r(c)?be(b.dataSource.aggregate()):c,d=a(b._wrapFooter(e(c))),g=b.footer||b.wrapper.find(".k-grid-footer");if(g.length){var h=d;g.replaceWith(h),b.footer=h}else f.scrollable?b.footer=f.pageable?d.insertBefore(b.wrapper.children("div.k-grid-pager")):d.appendTo(b.wrapper):b.footer=d.insertBefore(b.tbody);if(f.scrollable){var i=!1;b.scrollables.each(function(){a(this).hasClass("k-grid-footer-wrap")&&(i=!0)}),i||(b.scrollables=b.scrollables.add(b.footer.children(".k-grid-footer-wrap")))}f.resizable&&b._footerWidth&&b.footer.find("table").css("width",b._footerWidth)}},_wrapFooter:function(b){var c=this,d="";if(c.options.scrollable){d=a('<div class="k-grid-footer"><div class="k-grid-footer-wrap"><table cellspacing="0"><tbody>'+b+"</tbody></table></div></div>"),c._appendCols(d.find("table"));return d}return'<tfoot class="k-grid-footer">'+b+"</tfoot>"},_columnMenu:function(){var b=this,d,e=b.columns,f,g=b.options,h=g.columnMenu,i,j,l,m;h&&(typeof h=="boolean"&&(h={}),b.thead.find("th:not(.k-hierarchy-cell,.k-group-cell)").each(function(n){f=e[n],m=a(this),!f.command&&(f.field||m.attr("data-"+c.ns+"field"))&&(d=m.data("kendoColumnMenu"),d&&d.destroy(),j=f.sortable!==!1&&h.sortable!==!1?g.sortable:!1,l=g.filterable&&f.filterable!==!1&&h.filterable!==!1?k({},f.filterable,g.filterable):!1,i={dataSource:b.dataSource,values:f.values,columns:h.columns,sortable:j,filterable:l,messages:h.messages,owner:b},m.kendoColumnMenu(i))}))},_filterable:function(){var b=this,d=b.columns,e,f,g=b.options.filterable;g&&!b.options.columnMenu&&b.thead.find("th:not(.k-hierarchy-cell,.k-group-cell)").each(function(h){e=a(this),d[h].filterable!==!1&&!d[h].command&&(d[h].field||e.attr("data-"+c.ns+"field"))&&(f=e.data("kendoFilterMenu"),f&&f.destroy(),e.kendoFilterMenu(k(!0,{},g,d[h].filterable,{dataSource:b.dataSource,values:d[h].values})))})},_sortable:function(){var b=this,d=b.columns,e,f=b.options.sortable;f&&b.thead.find("th:not(.k-hierarchy-cell,.k-group-cell)").each(function(g){e=d[g],e.sortable!==!1&&!e.command&&e.field&&a(this).attr("data-"+c.ns+"field",e.field).kendoSortable(k({},f,{dataSource:b.dataSource}))})},_columns:function(b){var d=this,e=d.table,f,g=e.find("col"),h=d.options.dataSource;b=b.length?b:l(e.find("th"),function(b,d){b=a(b);var e=b.attr(c.attr("sortable")),f=b.attr(c.attr("filterable")),h=b.attr(c.attr("type")),i=b.attr(c.attr("groupable")),j=b.attr(c.attr("field")),k=b.attr(c.attr("menu"));j||(j=b.text().replace(/\s|[^A-z0-9]/g,""));return{field:j,type:h,sortable:e!=="false",filterable:f!=="false",groupable:i!=="false",menu:k,template:b.attr(c.attr("template")),width:g.eq(d).css("width")}}),f=!(d.table.find("tbody tr").length>0&&(!h||!h.transport)),d.columns=l(b,function(a){a=typeof a===U?{field:a}:a,a.hidden&&(a.attributes=bi(a.attributes),a.footerAttributes=bi(a.footerAttributes),a.headerAttributes=bi(a.headerAttributes));return k({encoded:f},a)})},_tmpl:function(a,b){var d=this,e=k({},c.Template,d.options.templateSettings),f,g=d.columns.length,h,i={storage:{},count:0},j,l,m=d._hasDetails(),n=[],o=d.dataSource.group().length;if(!a){a="<tr",b&&n.push("k-alt"),m&&n.push("k-master-row"),n.length&&(a+=' class="'+n.join(" ")+'"'),g&&(a+=" "+c.attr("uid")+'="#=uid#"'),a+=">",o>0&&(a+=_(o)),m&&(a+='<td class="k-hierarchy-cell"><a class="k-icon k-plus" href="\\#"></a></td>');for(f=0;f<g;f++)j=d.columns[f],h=j.template,l=typeof h,a+="<td"+ba(j.attributes)+">",a+=d._cellTmpl(j,i),a+="</td>";a+="</tr>"}a=c.template(a,e);if(i.count>0)return p(a,i.storage);return a},_headerCellText:function(a){var b=this,d=k({},c.Template,b.options.templateSettings),e=a.headerTemplate,f=typeof e,g=a.title||a.field||"";f===T?g=c.template(e,d)({}):f===U&&(g=e);return g},_cellTmpl:function(a,b){var d=this,e=k({},c.Template,d.options.templateSettings),f=a.template,g=e.paramName,h="",i,l,m=a.format,o=typeof f,p=a.values;if(a.command){if(n(a.command)){for(i=0,l=a.command.length;i<l;i++)h+=d._createButton(a.command[i]);return h.replace(Y,"\\#")}return d._createButton(a.command).replace(Y,"\\#")}o===T?(b.storage["tmpl"+b.count]=f,h+="#=this.tmpl"+b.count+"("+g+")#",b.count++):o===U?h+=f:p&&p.length&&j(p[0])&&"value"in p[0]?(h+="#var v ="+c.stringify(p)+"#",h+="#for (var idx=0,length=v.length;idx<length;idx++) {#",h+="#if (v[idx].value == ",e.useWithBlock||(h+=g+"."),h+=a.field,h+=") { #",h+="${v[idx].text}",h+="#break;#",h+="#}#",h+="#}#"):(h+=a.encoded?"${":"#=",m&&(h+='kendo.format("'+m.replace(W,"\\$1")+'",'),e.useWithBlock||(h+=g+"."),h+=a.field,m&&(h+=")"),h+=a.encoded?"}":"#");return h},_templates:function(){var b=this,c=b.options,d=b.dataSource,e=d.group(),f=d.aggregate();b.rowTemplate=b._tmpl(c.rowTemplate),b.altRowTemplate=b._tmpl(c.altRowTemplate||c.rowTemplate,!0),b._hasDetails()&&(b.detailTemplate=b._detailTmpl(c.detailTemplate||""));if(!r(f)||m(b.columns,function(a){return a.footerTemplate}).length)b.footerTemplate=b._footerTmpl(f,"footerTemplate","k-footer-template");e.length&&m(b.columns,function(a){return a.groupFooterTemplate}).length&&(f=a.map(e,function(a){return a.aggregates}),b.groupFooterTemplate=b._footerTmpl(f,"groupFooterTemplate","k-group-footer"))},_footerTmpl:function(a,b,d){var e=this,f=k({},c.Template,e.options.templateSettings),g=f.paramName,h="",i,j,l=e.columns,m,n,o={},q=0,r={},s=e.dataSource,t=s.group().length,u=be(a),v;h+='<tr class="'+d+'">',t>0&&(h+=_(t)),e._hasDetails()&&(h+='<td class="k-hierarchy-cell">&nbsp;</td>');for(i=0,j=e.columns.length;i<j;i++)v=l[i],m=v[b],n=typeof m,h+="<td"+ba(v.footerAttributes)+">",m?(n!==T&&(r=u[v.field]?k({},f,{paramName:g+"."+v.field}):{},m=c.template(m,r)),o["tmpl"+q]=m,h+="#=this.tmpl"+q+"("+g+")#",q++):h+="&nbsp;",h+="</td>";h+="</tr>",h=c.template(h,f);if(q>0)return p(h,o);return h},_detailTmpl:function(a){var b=this,d="",e=k({},c.Template,b.options.templateSettings),f=e.paramName,g={},h=0,i=b.dataSource.group().length,j=bh(b.columns).length,l=typeof a;d+='<tr class="k-detail-row">',i>0&&(d+=_(i)),d+='<td class="k-hierarchy-cell"></td><td class="k-detail-cell"'+(j?' colspan="'+j+'"':"")+">",l===T?(g["tmpl"+h]=a,d+="#=this.tmpl"+h+"("+f+")#",h++):d+=a,d+="</td></tr>",d=c.template(d,e);if(h>0)return p(d,g);return d},_hasDetails:function(){var a=this;return a.options.detailTemplate!==b||(a._events[D]||[]).length},_details:function(){var b=this;b.table.delegate(".k-hierarchy-cell .k-plus, .k-hierarchy-cell .k-minus",Q,function(c){var d=a(this),e=d.hasClass("k-plus"),f=d.closest("tr.k-master-row"),g,h=b.detailTemplate,i,j=b._hasDetails();d.toggleClass("k-plus",!e).toggleClass("k-minus",e),j&&!f.next().hasClass("k-detail-row")&&(i=b.dataItem(f),a(h(i)).addClass(f.hasClass("k-alt")?"k-alt":"").insertAfter(f),b.trigger(D,{masterRow:f,detailRow:f.next(),data:i,detailCell:f.next().find(".k-detail-cell")})),g=f.next(),b.trigger(e?J:K,{masterRow:f,detailRow:g}),g.toggle(e),c.preventDefault();return!1})},dataItem:function(b){return this._data[this.tbody.find("> tr:not(.k-grouping-row,.k-detail-row,.k-group-footer)").index(a(b))]},expandRow:function(b){a(b).find("> td .k-plus, > td .k-i-expand").click()},collapseRow:function(b){a(b).find("> td .k-minus, > td .k-i-collapse").click()},_thead:function(){var d=this,e=d.columns,f=d._hasDetails()&&e.length,g,h,i="",j=d.table.find(">thead"),k,l,m;j.length||(j=a("<thead/>").insertBefore(d.tbody)),k=d.element.find("tr:has(th):first"),k.length||(k=j.children().first(),k.length||(k=a("<tr/>")));if(!k.children().length){f&&(i+='<th class="k-hierarchy-cell">&nbsp;</th>');for(g=0,h=e.length;g<h;g++)m=e[g],l=d._headerCellText(m),m.command?i+="<th"+ba(m.headerAttributes)+">"+l+"</th>":(i+="<th "+c.attr("field")+"='"+(m.field||"")+"' ",m.title&&(i+=c.attr("title")+'="'+m.title.replace(/'/g,"'")+'" '),m.groupable!==b&&(i+=c.attr("groupable")+"='"+m.groupable+"' "),m.aggregates&&(i+=c.attr("aggregates")+"='"+m.aggregates+"'"),i+=ba(m.headerAttributes),i+=">"+l+"</th>");k.html(i)}else f&&!k.find(".k-hierarchy-cell")[0]&&k.prepend('<th class="k-hierarchy-cell">&nbsp;</th>');k.find("th").addClass("k-header"),d.options.scrollable||j.addClass("k-grid-header"),k.appendTo(j),d.thead=j,d._sortable(),d._filterable(),d._scrollable(),d._updateCols(),d._resizable(),d._draggable(),d._reorderable(),d._columnMenu()},_updateCols:function(){var a=this;a._appendCols(a.thead.parent().add(a.table))},_appendCols:function(a){var b=this;bk(a,bh(b.columns),b._hasDetails(),b.dataSource.group().length)},_autoColumns:function(a){if(a&&a.toJSON){var b=this,c;a=a.toJSON();for(c in a)b.columns.push({field:c});b._thead(),b._templates()}},_rowsHtml:function(a){var b=this,c="",d,e,f=b.rowTemplate,g=b.altRowTemplate;for(d=0,e=a.length;d<e;d++)d%2?c+=g(a[d]):c+=f(a[d]),b._data.push(a[d]);return c},_groupRowHtml:function(a,b,d){var e=this,f="",g,h,i=a.field,j=m(e.columns,function(a){return a.field==i})[0]||{},l=j.format?c.format(j.format,a.value):a.value,n=j.groupHeaderTemplate,o=(j.title||i)+": "+l,p=k({},{field:a.field,value:a.value},a.aggregates[a.field]),q=a.items;n&&(o=typeof n===T?n(p):c.template(n)(p)),f+='<tr class="k-grouping-row">'+_(d)+'<td colspan="'+b+'">'+'<p class="k-reset">'+'<a class="k-icon k-i-collapse" href="#"></a>'+o+"</p></td></tr>";if(a.hasSubgroups)for(g=0,h=q.length;g<h;g++)f+=e._groupRowHtml(q[g],b-1,d+1);else f+=e._rowsHtml(q);e.groupFooterTemplate&&(f+=e.groupFooterTemplate(a.aggregates));return f},collapseGroup:function(b){b=a(b).find(".k-icon").addClass("k-i-expand").removeClass("k-i-collapse").end();var c=b.find(".k-group-cell").length,d=1,e,f;b.nextAll("tr").each(function(){f=a(this),e=f.find(".k-group-cell").length,f.hasClass("k-grouping-row")?d++:f.hasClass("k-group-footer")&&d--;if(e<=c||f.hasClass("k-group-footer")&&d<0)return!1;f.hide()})},expandGroup:function(b){b=a(b).find(".k-icon").addClass("k-i-collapse").removeClass("k-i-expand").end();var c=this,d=b.find(".k-group-cell").length,e,f,g=1;b.nextAll("tr").each(function(){e=a(this),f=e.find(".k-group-cell").length;if(f<=d)return!1;f==d+1&&!e.hasClass("k-detail-row")&&(e.show(),e.hasClass("k-grouping-row")&&e.find(".k-icon").hasClass("k-i-collapse")&&c.expandGroup(e),e.hasClass("k-master-row")&&e.find(".k-icon").hasClass("k-minus")&&e.next().show()),e.hasClass("k-grouping-row")&&g++,e.hasClass("k-group-footer")&&(g==1?e.show():g--)})},_updateHeader:function(b){var c=this,d=c.thead.find("th.k-group-cell"),e=d.length;b>e?a(Array(b-e+1).join('<th class="k-group-cell k-header">&nbsp;</th>')).prependTo(c.thead.find("tr")):b<e&&(e=e-b,a(m(d,function(a,b){return e>b})).remove())},_firstDataItem:function(a,b){a&&b&&(a.hasSubgroups?a=this._firstDataItem(a.items[0],b):a=a.items[0]);return a},hideColumn:function(b){var c=this,d,e,f,g,h,i,j=0,k,l=c.footer||c.wrapper.find(".k-grid-footer"),n=c.columns,p;typeof b=="number"?b=n[b]:b=m(n,function(a){return a.field===b})[0];if(!!b&&!b.hidden){p=o(b,bh(n)),b.hidden=!0,b.attributes=bi(b.attributes),b.footerAttributes=bi(b.footerAttributes),b.headerAttributes=bi(b.headerAttributes),c._templates(),c._updateCols(),c.thead.find(">tr>th:not(.k-hierarchy-cell,.k-group-cell):visible").eq(p).hide(),l&&(c._appendCols(l.find("table:first")),l.find(".k-footer-template>td:not(.k-hierarchy-cell,.k-group-cell):visible").eq(p).hide()),d=c.tbody.children();for(g=0,k=d.length;g<k;g+=1)e=d.eq(g),e.is(".k-grouping-row,.k-detail-row")?(f=e.children(":not(.k-group-cell):first,.k-detail-cell").last(),f.attr("colspan",parseInt(f.attr("colspan"),10)-1)):(e.hasClass("k-grid-edit-row")&&(f=e.children(".k-edit-container")[0])&&(f=a(f),f.attr("colspan",parseInt(f.attr("colspan"),10)-1),f.find("col").eq(p).remove(),e=f.find("tr:first")),e.children(":not(.k-group-cell,.k-hierarchy-cell):visible").eq(p).hide());h=c.thead.prev().find("col");for(g=0,k=h.length;g<k;g+=1){i=h[g].style.width;if(i&&i.indexOf("%")==-1)j+=parseInt(i,10);else{j=0;break}}j&&a(">.k-grid-header table:first,>.k-grid-footer table:first",c.wrapper).add(c.table).width(j),c.trigger(F,{column:b})}},showColumn:function(b){var c=this,d,e,f,g,h,i,j,k,l,n=c.columns,p=c.footer||c.wrapper.find(".k-grid-footer"),q;typeof b=="number"?b=n[b]:b=m(n,function(a){return a.field===b})[0];if(!!b&&!!b.hidden){q=o(b,n),b.hidden=!1,b.attributes=bj(b.attributes),b.footerAttributes=bj(b.footerAttributes),b.headerAttributes=bj(b.headerAttributes),c._templates(),c._updateCols(),c.thead.find(">tr>th:not(.k-hierarchy-cell,.k-group-cell)").eq(q).show(),p&&(c._appendCols(p.find("table:first")),p.find(".k-footer-template>td:not(.k-hierarchy-cell,.k-group-cell)").eq(q).show()),d=c.tbody.children();for(e=0,f=d.length;e<f;e+=1)g=d.eq(e),g.is(".k-grouping-row,.k-detail-row")?(h=g.children(":not(.k-group-cell):first,.k-detail-cell").last(),h.attr("colspan",parseInt(h.attr("colspan"),10)+1)):(g.hasClass("k-grid-edit-row")&&(h=g.children(".k-edit-container")[0])&&(h=a(h),h.attr("colspan",parseInt(h.attr("colspan"),10)+1),bk(h.find(">form>table"),bh(n),!1,0),g=h.find("tr:first")),g.children(":not(.k-group-cell,.k-hierarchy-cell)").eq(q).show());i=a(">.k-grid-header table:first,>.k-grid-footer table:first",c.wrapper).add(c.table);if(!b.width)i.width("");else{j=0,l=c.thead.prev().find("col");for(e=0,f=l.length;e<f;e+=1){k=l[e].style.width;if(k.indexOf("%")>-1){j=0;break}j+=parseInt(k,10)}j&&i.width(j)}c.trigger(G,{column:b})}},_progress:function(a){var b=this,d=b.element.is("table")?b.element.parent():b.content&&b.content.length?b.content:b.element;c.ui.progress(d,a)},refresh:function(b){var c=this,d,e,f="",h=c.dataSource.view(),i,j,k,l=c.current(),m=(c.dataSource.group()||[]).length,n=m+bh(c.columns).length;if(!b||b.action!=="itemchange"||!c.editable){c.trigger("dataBinding"),l&&l.hasClass("k-state-focused")&&(k=c.items().index(l.parent())),c._destroyEditable(),c._progress(!1),c._data=[],c.columns.length||(c._autoColumns(c._firstDataItem(h[0],m)),n=m+c.columns.length),c._group=m>0||c._group,c._group&&(c._templates(),c._updateCols(),c._updateHeader(m),c._group=m>0);if(m>0){c.detailTemplate&&n++;for(e=0,d=h.length;e<d;e++)f+=c._groupRowHtml(h[e],n,0)}else f+=c._rowsHtml(h);g?c.tbody[0].innerHTML=f:(j=document.createElement("div"),j.innerHTML="<table><tbody>"+f+"</tbody></table>",i=j.firstChild.firstChild,c.table[0].replaceChild(i,c.tbody[0]),c.tbody=a(i)),c._footer(),c._setContentHeight(),k>=0&&c.current(c.items().eq(k).children().filter(w).first()),c.trigger(I)}}});d.plugin(bl),d.plugin($)})(jQuery);