/*
* Kendo UI Web v2012.2.710 (http://kendoui.com)
* Copyright 2012 Telerik AD. All rights reserved.
*
* Kendo UI Web commercial licenses may be obtained at http://kendoui.com/web-license
* If you do not own a commercial license, this file shall be governed by the
* GNU General Public License (GPL) version 3.
* For GPL requirements, please review: http://www.gnu.org/copyleft/gpl.html
*/
;(function(a,b){function F(){var c={},d=a("meta[name=csrf-token]").attr("content"),e=a("meta[name=csrf-param]").attr("content");a("input[name^='__RequestVerificationToken']").each(function(){c[this.name]=this.value}),e!==b&&d!==b&&(c[e]=d);return c}function E(b){return a(b.target).closest(".k-file")}function D(a){return a.children(".k-icon").is(".k-loading, .k-success, .k-fail")}function C(a,b,c){var d,e;a.bind("dragenter",function(a){b(),e=new Date,d||(d=setInterval(function(){var a=new Date-e;a>100&&(c(),clearInterval(d),d=null)},100))}).bind("dragover",function(a){e=new Date})}function B(a){a.stopPropagation(),a.preventDefault()}function A(b,c,d){var e=!1,f="";try{f=a.parseJSON(b),e=!0}catch(g){d()}e&&c(f)}function z(b,c,d){if(!!c._supportsRemove()){var f=b.data("fileNames"),g=a.map(f,function(a){return a.name});c._submitRemove(g,d,function(a,d,e){c._removeFileEntry(b),c.trigger(i,{operation:"remove",files:f,response:a,XMLHttpRequest:e})},function(a,b,b){var d=c.trigger(j,{operation:"remove",files:f,XMLHttpRequest:a});e("Server response: "+a.responseText)})}}function y(a){var b=a.lastIndexOf("\\");return b!=-1?a.substr(b+1):a}function x(a){var b=a.match(f);return b?b[0]:""}function w(a){var b=a.name||a.fileName;return{name:b,extension:x(b),size:a.size||a.fileSize,rawFile:a}}function v(b){return a.map(b,function(a){return w(a)})}function u(a){var b=a[0];return b.files?v(b.files):[{name:y(b.value),extension:x(b.value),size:null}]}function t(b){return a.map(u(b),function(a){return a.name}).join(", ")}var c=window.kendo,d=c.ui.Widget,e=c.logToConsole,f=/\.([^\.]+)$/,g="select",h="upload",i="success",j="error",k="complete",l="cancel",m="load",n="progress",o="remove",p=d.extend({init:function(c,e){var f=this;d.fn.init.call(f,c,e),f.name=c.name,f.multiple=f.options.multiple,f.localization=f.options.localization;var g=f.element;f.wrapper=g.closest(".k-upload"),f.wrapper.length==0&&(f.wrapper=f._wrapInput(g)),f._activeInput(g),f.toggle(f.options.enabled),g.closest("form").bind({submit:a.proxy(f._onParentFormSubmit,f),reset:a.proxy(f._onParentFormReset,f)}),f.options.async.saveUrl!=b?(f._module=f._supportsFormData()?new s(f):new r(f),f._async=!0):f._module=new q(f),f._supportsDrop()&&f._setupDropZone(),f.wrapper.delegate(".k-upload-action","click",a.proxy(f._onFileAction,f)).delegate(".k-upload-selected","click",a.proxy(f._onUploadSelected,f)).delegate(".k-file","t:progress",a.proxy(f._onFileProgress,f)).delegate(".k-file","t:upload-success",a.proxy(f._onUploadSuccess,f)).delegate(".k-file","t:upload-error",a.proxy(f._onUploadError,f))},events:[g,h,i,j,k,l,n,o],options:{name:"Upload",enabled:!0,multiple:!0,showFileList:!0,async:{removeVerb:"POST",autoUpload:!0},localization:{select:"Select...",cancel:"Cancel",retry:"Retry",remove:"Remove",uploadSelectedFiles:"Upload files",dropFilesHere:"drop files here to upload",statusUploading:"uploading",statusUploaded:"uploaded",statusFailed:"failed"}},setOptions:function(a){var b=this,c=b.element;d.fn.setOptions.call(b,a),b.multiple=b.options.multiple,c.attr("multiple",b._supportsMultiple()?b.multiple:!1),b.toggle(b.options.enabled)},enable:function(a){a=typeof a=="undefined"?!0:a,this.toggle(a)},disable:function(){this.toggle(!1)},toggle:function(a){a=typeof a=="undefined"?a:!a,this.wrapper.toggleClass("k-state-disabled",a)},_addInput:function(b){var c=this;b.insertAfter(c.element).data("kendoUpload",c),a(c.element).hide().removeAttr("id"),c._activeInput(b)},_activeInput:function(b){var c=this,d=c.wrapper;c.element=b,b.attr("multiple",c._supportsMultiple()?c.multiple:!1).attr("autocomplete","off").click(function(a){d.hasClass("k-state-disabled")&&a.preventDefault()}).change(a.proxy(c._onInputChange,c))},_onInputChange:function(b){var c=this,d=a(b.target),e=c.trigger(g,{files:u(d)});e?(c._addInput(d.clone().val("")),d.remove()):d.trigger("t:select")},_onDrop:function(b){var c=b.originalEvent.dataTransfer,d=this,e=c.files;B(b);if(e.length>0){var f=d.trigger(g,{files:v(e)});f||a(".k-dropzone",d.wrapper).trigger("t:select",[e])}},_enqueueFile:function(b,c){var d=this,e,f,g=a(".k-upload-files",d.wrapper);g.length==0&&(g=a("<ul class='k-upload-files k-reset'></ul>").appendTo(d.wrapper),d.options.showFileList||g.hide()),e=a(".k-file",g),f=a("<li class='k-file'><span class='k-filename' title='"+b+"'>"+b+"</span></li>").appendTo(g).data(c),d._async&&f.prepend("<span class='k-icon'></span>"),d.multiple||e.trigger("t:remove");return f},_removeFileEntry:function(b){var c=b.closest(".k-upload-files"),d;b.remove(),d=a(".k-file",c),d.find("> .k-fail").length===d.length&&this._hideUploadButton(),d.length==0&&c.remove()},_fileAction:function(a,b){var c={remove:"k-delete",cancel:"k-cancel",retry:"k-retry"};!c.hasOwnProperty(b)||(this._clearFileAction(a),a.append(this._renderAction(c[b],this.localization[b]).addClass("k-upload-action")))},_fileState:function(a,b){var c=this.localization,d={uploading:{cssClass:"k-loading",text:c.statusUploading},uploaded:{cssClass:"k-success",text:c.statusUploaded},failed:{cssClass:"k-fail",text:c.statusFailed}},e=d[b];if(e){var f=a.children(".k-icon").text(e.text);f[0].className="k-icon "+e.cssClass}},_renderAction:function(b,c){return b!=""?a("<button type='button' class='k-button k-button-icontext'><span class='k-icon "+b+"'></span>"+c+"</button>"):a("<button type='button' class='k-button'>"+c+"</button>")},_clearFileAction:function(a){a.find(".k-upload-action").remove()},_onFileAction:function(b){var c=this;if(!c.wrapper.hasClass("k-state-disabled")){var d=a(b.target).closest(".k-upload-action"),e=d.find(".k-icon"),f=d.closest(".k-file"),g={files:f.data("fileNames")};e.hasClass("k-delete")?c.trigger(o,g)||f.trigger("t:remove",g.data):e.hasClass("k-cancel")?(c.trigger(l,g),f.trigger("t:cancel"),this._checkAllComplete()):e.hasClass("k-retry")&&f.trigger("t:retry")}return!1},_onUploadSelected:function(){this.wrapper.trigger("t:saveSelected");return!1},_onFileProgress:function(b,c){var d=a(".k-progress-status",b.target);d.length==0&&(d=a("<span class='k-progress'><span class='k-state-selected k-progress-status' style='width: 0;'></span></span>").appendTo(a(".k-filename",b.target)).find(".k-progress-status")),d.width(c+"%"),this.trigger(n,{files:E(b).data("fileNames"),percentComplete:c})},_onUploadSuccess:function(a,b,c){var d=E(a);this._fileState(d,"uploaded"),this.trigger(i,{files:d.data("fileNames"),response:b,operation:"upload",XMLHttpRequest:c}),this._supportsRemove()?this._fileAction(d,o):this._clearFileAction(d),this._checkAllComplete()},_onUploadError:function(a,b){var c=E(a);this._fileState(c,"failed"),this._fileAction(c,"retry");var d=this.trigger(j,{operation:"upload",files:c.data("fileNames"),XMLHttpRequest:b});e("Server response: "+b.responseText),this._checkAllComplete()},_showUploadButton:function(){var b=a(".k-upload-selected",this.wrapper);b.length==0&&(b=this._renderAction("",this.localization.uploadSelectedFiles).addClass("k-upload-selected")),this.wrapper.append(b)},_hideUploadButton:function(){a(".k-upload-selected",this.wrapper).remove()},_onParentFormSubmit:function(){var b=this,c=b.element;c.trigger("t:abort");if(!c.value){var d=a(c);d.attr("disabled","disabled"),window.setTimeout(function(){d.removeAttr("disabled")},0)}},_onParentFormReset:function(){a(".k-upload-files",this.wrapper).remove()},_supportsFormData:function(){return typeof FormData!="undefined"},_supportsMultiple:function(){return!a.browser.opera},_supportsDrop:function(){var a=this._userAgent().toLowerCase(),c=/chrome/.test(a),d=!c&&/safari/.test(a),e=d&&/windows/.test(a);return!e&&this._supportsFormData()&&this.options.async.saveUrl!=b},_userAgent:function(){return navigator.userAgent},_setupDropZone:function(){a(".k-upload-button",this.wrapper).wrap("<div class='k-dropzone'></div>");var b=a(".k-dropzone",this.wrapper).append(a("<em>"+this.localization.dropFilesHere+"</em>")).bind({dragenter:B,dragover:function(a){a.preventDefault()},drop:a.proxy(this._onDrop,this)});C(b,function(){b.addClass("k-dropzone-hovered")},function(){b.removeClass("k-dropzone-hovered")}),C(a(document),function(){b.addClass("k-dropzone-active")},function(){b.removeClass("k-dropzone-active")})},_supportsRemove:function(){return this.options.async.removeUrl!=b},_submitRemove:function(b,c,d,e){var f=this,g=f.options.async.removeField||"fileNames",h=a.extend(c,F());h[g]=b,a.ajax({type:this.options.async.removeVerb,dataType:"json",url:this.options.async.removeUrl,traditional:!0,data:h,success:d,error:e})},_wrapInput:function(a){a.wrap("<div class='k-widget k-upload'><div class='k-button k-upload-button'></div></div>"),a.closest(".k-button").append("<span>"+this.localization.select+"</span>");return a.closest(".k-upload")},_checkAllComplete:function(){a(".k-file .k-icon.k-loading",this.wrapper).length==0&&this.trigger(k)}}),q=function(b){this.name="syncUploadModule",this.element=b.wrapper,this.upload=b,this.element.bind("t:select",a.proxy(this.onSelect,this)).bind("t:remove",a.proxy(this.onRemove,this)).closest("form").attr("enctype","multipart/form-data").attr("encoding","multipart/form-data")};q.prototype={onSelect:function(b){var c=this.upload,d=a(b.target);c._addInput(d.clone().val(""));var e=c._enqueueFile(t(d),{relatedInput:d,fileNames:u(d)});c._fileAction(e,o)},onRemove:function(a){var b=E(a);b.data("relatedInput").remove(),this.upload._removeFileEntry(b)}};var r=function(b){this.name="iframeUploadModule",this.element=b.wrapper,this.upload=b,this.iframes=[],this.element.bind("t:select",a.proxy(this.onSelect,this)).bind("t:cancel",a.proxy(this.onCancel,this)).bind("t:retry",a.proxy(this.onRetry,this)).bind("t:remove",a.proxy(this.onRemove,this)).bind("t:saveSelected",a.proxy(this.onSaveSelected,this)).bind("t:abort",a.proxy(this.onAbort,this))};p._frameId=0,r.prototype={onSelect:function(b){var c=this.upload,d=a(b.target),e=this.prepareUpload(d);c.options.async.autoUpload?this.performUpload(e):(c._supportsRemove()&&this.upload._fileAction(e,o),c._showUploadButton())},prepareUpload:function(b){var c=this.upload,d=a(c.element),e=c.options.async.saveField||b.attr("name");c._addInput(b.clone().val("")),b.attr("name",e);var f=this.createFrame(c.name+"_"+p._frameId++);this.registerFrame(f);var g=this.createForm(c.options.async.saveUrl,f.attr("name")).append(d),h=c._enqueueFile(t(b),{frame:f,relatedInput:d,fileNames:u(b)});f.data({form:g,file:h});return h},performUpload:function(b){var c={files:b.data("fileNames")},d=b.data("frame"),e=this.upload;if(!e.trigger(h,c)){e._hideUploadButton(),d.appendTo(document.body);var f=d.data("form").appendTo(document.body);c.data=a.extend({},c.data,F());for(var g in c.data){var i=f.find("input[name='"+g+"']");i.length==0&&(i=a("<input>",{type:"hidden",name:g}).appendTo(f)),i.val(c.data[g])}e._fileAction(b,l),e._fileState(b,"uploading"),d.one("load",a.proxy(this.onIframeLoad,this)),f[0].submit()}else e._removeFileEntry(d.data("file")),this.cleanupFrame(d),this.unregisterFrame(d)},onSaveSelected:function(b){var c=this;a(".k-file",this.element).each(function(){var b=a(this),d=D(b);d||c.performUpload(b)})},onIframeLoad:function(b){var c=a(b.target);try{var d=c.contents().text()}catch(b){d="Error trying to get server response: "+b}this.processResponse(c,d)},processResponse:function(b,c){var d=b.data("file"),e=this,f={responseText:c};A(c,function(c){a.extend(f,{statusText:"OK",status:"200"}),d.trigger("t:progress",[100]),d.trigger("t:upload-success",[c,f]),e.cleanupFrame(b),e.unregisterFrame(b)},function(){a.extend(f,{statusText:"error",status:"500"}),d.trigger("t:upload-error",[f])})},onCancel:function(b){var c=a(b.target).data("frame");this.stopFrameSubmit(c),this.cleanupFrame(c),this.unregisterFrame(c),this.upload._removeFileEntry(c.data("file"))},onRetry:function(a){var b=E(a);this.performUpload(b)},onRemove:function(a,b){var c=E(a),d=c.data("frame");d?(this.unregisterFrame(d),this.upload._removeFileEntry(c),this.cleanupFrame(d)):z(c,this.upload,b)},onAbort:function(){var b=this.element,c=this;a.each(this.iframes,function(){a("input",this.data("form")).appendTo(b),c.stopFrameSubmit(this[0]),this.data("form").remove(),this.remove()}),this.iframes=[]},createFrame:function(b){return a("<iframe name='"+b+"'"+" id='"+b+"'"+" style='display:none;' />")},createForm:function(b,c){return a("<form enctype='multipart/form-data' method='POST' action='"+b+"'"+" target='"+c+"'"+"/>")},stopFrameSubmit:function(a){typeof a.stop!="undefined"?a.stop():a.document&&(a.document.execCommand("Stop"),a.contentWindow.location.href=a.contentWindow.location.href)},registerFrame:function(a){this.iframes.push(a)},unregisterFrame:function(b){this.iframes=a.grep(this.iframes,function(a){return a.attr("name")!=b.attr("name")})},cleanupFrame:function(a){var b=a.data("form");a.data("file").data("frame",null),setTimeout(function(){b.remove(),a.remove()},1)}};var s=function(b){this.name="formDataUploadModule",this.element=b.wrapper,this.upload=b,this.element.bind("t:select",a.proxy(this.onSelect,this)).bind("t:cancel",a.proxy(this.onCancel,this)).bind("t:remove",a.proxy(this.onRemove,this)).bind("t:retry",a.proxy(this.onRetry,this)).bind("t:saveSelected",a.proxy(this.onSaveSelected,this)).bind("t:abort",a.proxy(this.onAbort,this))};s.prototype={onSelect:function(b,c){var d=this.upload,e=this,f=a(b.target),g=c?v(c):this.inputFiles(f),h=this.prepareUpload(f,g);a.each(h,function(){d.options.async.autoUpload?e.performUpload(this):(d._supportsRemove()&&d._fileAction(this,o),d._showUploadButton())})},prepareUpload:function(b,c){var d=this.enqueueFiles(c);b.is("input")&&(a.each(d,function(){a(this).data("relatedInput",b)}),b.data("relatedFileEntries",d),this.upload._addInput(b.clone().val("")));return d},enqueueFiles:function(a){var b=this.upload;fileEntries=[];for(var c=0;c<a.length;c++){var d=a[c],e=d.name,f=b._enqueueFile(e,{fileNames:[d]});f.data("file",d),fileEntries.push(f)}return fileEntries},inputFiles:function(a){return u(a)},performUpload:function(b){var c=this.upload,d=this.createFormData(b.data("file")),e={files:b.data("fileNames")};if(!c.trigger(h,e)){c._fileAction(b,l),c._hideUploadButton(),e.data=a.extend({},e.data,F());for(var f in e.data)d.append(f,e.data[f]);c._fileState(b,"uploading"),this.postFormData(this.upload.options.async.saveUrl,d,b)}else this.removeFileEntry(b)},onSaveSelected:function(b){var c=this;a(".k-file",this.element).each(function(){var b=a(this),d=D(b);d||c.performUpload(b)})},onCancel:function(a){var b=E(a);this.stopUploadRequest(b),this.removeFileEntry(b)},onRetry:function(a){var b=E(a);this.performUpload(b)},onRemove:function(a,b){var c=E(a);c.children(".k-icon").is(".k-success")?z(c,this.upload,b):this.removeFileEntry(c)},postFormData:function(a,b,c){var d=new XMLHttpRequest,e=this;c.data("request",d),d.addEventListener("load",function(a){e.onRequestSuccess.call(e,a,c)},!1),d.addEventListener(j,function(a){e.onRequestError.call(e,a,c)},!1),d.upload.addEventListener("progress",function(a){e.onRequestProgress.call(e,a,c)},!1),d.open("POST",a),d.withCredentials="true",d.send(b)},createFormData:function(a){var b=new FormData,c=this.upload;b.append(c.options.async.saveField||c.name,a.rawFile);return b},onRequestSuccess:function(a,b){function e(){b.trigger("t:upload-error",[c])}var c=a.target,d=this;c.status>=200&&c.status<=299?A(c.responseText,function(a){b.trigger("t:progress",[100]),b.trigger("t:upload-success",[a,c]),d.cleanupFileEntry(b)},e):e()},onRequestError:function(a,b){var c=a.target;b.trigger("t:upload-error",[c])},cleanupFileEntry:function(b){var c=b.data("relatedInput"),d=!0;c&&(a.each(c.data("relatedFileEntries")||[],function(){this.parent().length>0&&this[0]!=b[0]&&(d=d&&this.children(".k-icon").is(".k-success"))}),d&&c.remove())},removeFileEntry:function(a){this.cleanupFileEntry(a),this.upload._removeFileEntry(a)},onRequestProgress:function(a,b){var c=Math.round(a.loaded*100/a.total);b.trigger("t:progress",[c])},stopUploadRequest:function(a){a.data("request").abort()}},c.ui.plugin(p)})(jQuery);